<html lang="en">

<head>
    <%- include('partials/header') %>
</head>

<body>
    <%- include('partials/serverMessage') %>
    <main>
        <h1 class="alignCenter marginBottom30">Your account</h1>

        <form action="/account" method="POST">
            <div id="loginDiv" class="logRegDiv">

                <input type="text" placeholder="username" name="username" value="<%=user%>" />
                <input type="password" placeholder="old password" name="oldPassword" />
                <input type="password" placeholder="new password" name="newPassword" />
                <button class="marginTop30" type="submit">Change account settings</button>

                <button class="bg-red" onclick="deleteUser('<%=userId%>')">Delete account</button>
            </div>
        </form>
        <p class="alignCenter marginTop30 width80 marginAuto">When you delete your account, all of your poems, collections and comments will be deleted as well.</p>



    </main>

    <script>
        function deleteUser(id) {
            console.log("Delete user was triggered with id", id);

            fetch(`/account/${id}/deleted`, {
                    method: "DELETE"
                })
                .then((resp) => {
                    console.log(resp);
                    if (resp.redirected) {
                        window.location.href = resp.url;
                    }
                })
                .catch((err) => console.log(err));
        }
    </script>
</body>

</html>